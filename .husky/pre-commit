echo "ğŸ” Starting pre-commit checks..."

echo "ğŸ”¬ Running ESLint..."
pnpm lint

echo "ğŸ“ Updating git index after formatting..."
git update-index --again

echo "ğŸ” Checking for changed TypeScript files..."
changed_files=$(git diff --cached --name-only --diff-filter=AM | grep -E '\.(ts|tsx)$' || true)

if [ -n "$changed_files" ]; then
  echo "ğŸ§ª Running Vitest on changed files:"
  echo "$changed_files"
  echo "-------------------"
  pnpm exec vitest related --run $changed_files --passWithNoTests
else
  echo "âœ¨ No TypeScript files changed, skipping tests."
fi

echo "âœ… Pre-commit checks completed!"